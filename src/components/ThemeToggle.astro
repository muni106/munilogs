---
// ThemeToggle.astro
---

<button id="theme-toggle" class="button is-ghost theme-toggle-btn" aria-label="Toggle dark mode">
  <span class="icon theme-icon sun-icon">
    <i class="fas fa-sun"></i>
  </span>
  <span class="icon theme-icon moon-icon">
    <i class="fas fa-moon"></i>
  </span>
</button>

<script is:inline>
// Theme toggle functionality
document.addEventListener('DOMContentLoaded', () => {
  const themeToggle = document.getElementById('theme-toggle');
  const html = document.documentElement;
  
  // Get saved theme or default to system preference
  const savedTheme = localStorage.getItem('theme');
  const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const initialTheme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
  
  // Apply initial theme
  html.setAttribute('data-theme', initialTheme);
  updateToggleIcon(initialTheme);
  
  // Toggle theme on button click
  themeToggle.addEventListener('click', () => {
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    html.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateToggleIcon(newTheme);
  });
  
  // Update toggle icon based on current theme
  function updateToggleIcon(theme) {
    const sunIcon = themeToggle.querySelector('.sun-icon');
    const moonIcon = themeToggle.querySelector('.moon-icon');
    
    if (theme === 'dark') {
      sunIcon.style.display = 'block';
      moonIcon.style.display = 'none';
    } else {
      sunIcon.style.display = 'none';
      moonIcon.style.display = 'block';
    }
  }
  
  // Listen for system theme changes
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      const newTheme = e.matches ? 'dark' : 'light';
      html.setAttribute('data-theme', newTheme);
      updateToggleIcon(newTheme);
    }
  });
});
</script>

<style>
.theme-toggle-btn {
  border: none !important;
  background: transparent !important;
  padding: 0.5rem !important;
  border-radius: 50% !important;
  width: 40px !important;
  height: 40px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  transition: all 0.3s ease !important;
  position: relative !important;
}

.theme-toggle-btn:hover {
  background: var(--bulma-background-l) !important;
  transform: scale(1.1);
}

.theme-icon {
  position: absolute !important;
  transition: all 0.3s ease !important;
}

.sun-icon {
  color: #ffd700;
}

.moon-icon {
  color: #4a90e2;
}

/* Initial state - show moon icon (for light mode) */
.sun-icon {
  display: none;
}

.moon-icon {
  display: block;
}
</style>
